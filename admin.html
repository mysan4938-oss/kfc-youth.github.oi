<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>လူငယ်ဝတ်ပြုခြင်းအစီစဉ် - Youth Worship Program</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Configure Tailwind to use a custom font stack that supports Myanmar script
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Pyidaungsu', 'Myanmar Text', 'Inter', 'sans-serif'],
                    },
                    colors: {
                        'primary': '#1e3a8a', // Dark Indigo
                        'secondary': '#2c5aa0', // Lighter Indigo
                    }
                }
            }
        }
    </script>
    <!-- Custom style for better font support and scrollbar hiding -->
    <style>
        /* BASE STYLES */
        body {
            /* Keep base body background minimal */
            background-color: #0d001a; 
            font-family: 'Pyidaungsu', 'Myanmar Text', 'Inter', sans-serif;
            position: relative;
        }

        /* Ensure scrollbar hiding remains */
        .mobile-tabs::-webkit-scrollbar { display: none; }
        .mobile-tabs { -ms-overflow-style: none; scrollbar-width: none; }

        /* MAIN PAGE BACKGROUND */
        #main-bg-image {
            /* Using the RAW GitHub URL for the background image */
            background-image: url('https://raw.githubusercontent.com/mysan4938-oss/kfc-youth.github.oi/main/main.webp'); 
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            filter: blur(.5px) brightness(0.8); /* Slight blur and darken for readability */
        }
        
        /* Morph Glass Styles */
        .morph-glass {
            /* General Glass Effect */
            background: rgba(255, 255, 255, 0.1); /* Light backdrop */
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            /* Red/Green Highlights for Eyecatching Effect */
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2); 
            color: white; /* Ensure text is visible */
        }
        
        .morph-glass-card {
            background: rgba(255, 255, 255, 0.2); /* More transparent internal card */
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.4);
            /* Subtle inner shadow for depth */
            box-shadow: inset 0 0 10px rgba(255, 255, 255, 0.1);
        }
    </style>
</head>
<body class="min-h-screen p-4 md:p-8 font-sans">
    
    <!-- BACKGROUND DIV (One single div used for simplicity) -->
    <div id="main-bg-image" class="absolute inset-0 z-0 min-h-full"></div>

    <!-- MAIN SCHEDULE CONTENT -->
    <div id="schedule-content" class="container max-w-4xl mx-auto rounded-xl overflow-hidden morph-glass relative z-10">
        
        <!-- Header Section -->
        <header class="bg-primary text-white p-6 md:p-8 text-center rounded-t-xl" style="background: linear-gradient(135deg, #1e3a8a 0%, #2c5aa0 100%);">
            
            <!-- Branding/Logo -->
            <div class="mb-6"> 
                <img 
                    src="https://raw.githubusercontent.com/mysan4938-oss/kfc-youth.github.oi/refs/heads/main/KFC_Youth.webp" 
                    alt="KFC Youth 2025 Logo" 
                    class="w-65 h-30 mx-auto mb-2 rounded-xl border-2 border-white shadow-xl object-cover"
                    onerror="this.onerror=null; this.src='https://placehold.co/256x96/1e3a8a/ffffff?text=KFC+Youth'"
                >
                <div class="text-xl font-extrabold tracking-widest text-white mt-1">
                    KFC Youth 2025
                </div>
            </div>
            
            <h1 class="text-1xl font-extrabold mb-1 tracking-wide">လူငယ်ဝတ်ပြုခြင်းအစီစဉ် (၈ ပတ်)</h1>
            <div class="text-lg opacity-90">Youth Worship Program Schedule</div>
        </header>
        
        <!-- Weekly Program Button Re-added -->
        <div class="p-4 bg-white/10 text-center border-b border-white/20">
            <a href="wg.html" target="_blank" class="inline-block px-6 py-3 rounded-full font-bold text-white shadow-xl transition-all duration-300 transform hover:scale-105" 
               style="background: linear-gradient(90deg, #10b981 0%, #059669 100%);">
                Sunday Program (click)
            </a>
        </div>
        
        <div class="p-4 md:p-6 lg:p-8 text-white">
            
            <!-- Participants Section (Collapsible - morph-glass-card applied) -->
            <section class="mb-8 rounded-xl shadow-inner overflow-hidden morph-glass-card">
                <button class="w-full p-4 md:p-6 bg-white/20 hover:bg-white/30 transition duration-300 flex justify-between items-center" 
                        onclick="toggleSection('participants-content', this)">
                    <h2 class="text-xl md:text-2xl font-bold text-white">
                        ဆောင်ရွက်မည့်သူများ (မိန်းကလေး / ယောင်္ကျားလေး)
                    </h2>
                    <span class="text-2xl text-white transform transition-transform duration-300 transition-all">+</span>
                </button>
                
                <div id="participants-content" class="p-4 transition-all duration-500 max-h-0 overflow-hidden">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        
                        <div class="p-4 rounded-lg shadow-md border border-white/40 morph-glass-card">
                            <h3 class="text-lg font-semibold text-white text-center border-b border-dashed border-white/50 pb-2 mb-3">
                                မိန်းကလေး
                            </h3>
                            <ul class="grid grid-cols-2 gap-x-4 gap-y-2 list-none p-0">
                                <li class="border-b border-white/30 py-1 text-sm">May Lat Lunn</li>
                                <li class="border-b border-white/30 py-1 text-sm">Htoi Tsin Pan</li>
                                <li class="border-b border-white/30 py-1 text-sm">Zami Shar</li>
                                <li class="border-b border-white/30 py-1 text-sm">Mi Mi Shar</li>
                                <li class="border-b border-white/30 py-1 text-sm">Zami Shine</li>
                                <li class="border-b border-white/30 py-1 text-sm">Pan Ra</li>
                                <li class="border-b border-white/30 py-1 text-sm">Hpa Rat Hkawn</li>
                                <li class="border-b border-white/30 py-1 text-sm">Caroline</li>
                            </ul>
                        </div>
                        
                        <div class="p-4 rounded-lg shadow-md border border-white/40 morph-glass-card">
                            <h3 class="text-lg font-semibold text-white text-center border-b border-dashed border-white/50 pb-2 mb-3">
                                ယောင်္ကျားလေး
                            </h3>
                            <ul class="grid grid-cols-2 gap-x-4 gap-y-2 list-none p-0">
                                <li class="border-b border-white/30 py-1 text-sm">Tu Mai</li>
                                <li class="border-b border-white/30 py-1 text-sm">Seng Awng</li>
                                <li class="border-b border-white/30 py-1 text-sm">Ah Dau</li>
                                <li class="border-b border-white/30 py-1 text-sm">Dee Bine</li>
                                <li class="border-b border-white/30 py-1 text-sm">Benjamin</li>
                                <li class="border-b border-white/30 py-1 text-sm">Shin Ram</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Roles Section (Collapsible - morph-glass-card applied) -->
            <section class="mb-8 rounded-xl shadow-inner overflow-hidden morph-glass-card">
                <button class="w-full p-4 md:p-6 bg-white/20 hover:bg-white/30 transition duration-300 flex justify-between items-center"
                        onclick="toggleSection('roles-content', this)">
                    <h2 class="text-xl md:text-2xl font-bold text-white">
                        တာဝန်များ
                    </h2>
                    <span class="text-2xl text-white transform transition-transform duration-300 transition-all">+</span>
                </button>
                <div id="roles-content" class="p-4 transition-all duration-500 max-h-0 overflow-hidden">
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <!-- Role Item 1 -->
                        <div class="p-3 rounded-lg shadow-sm border-l-4 border-secondary morph-glass-card">
                            <strong class="text-secondary block mb-1">သဘာပတိ</strong>
                            <div class="text-sm text-gray-200">အစီအစဉ်ကို ဦးဆောင်ခြင်း</div>
                        </div>
                        <!-- Role Item for Piano -->
                        <div class="p-3 rounded-lg shadow-sm border-l-4 border-secondary morph-glass-card">
                            <strong class="text-secondary block mb-1">Piano</strong>
                            <div class="text-sm text-gray-200">၀တ်ပြုကိုးကွယ်ရာတွင် တူရိယာတီးခတ်ခြင်း</div>
                        </div>
                        <!-- Role Item for Scripture -->
                        <div class="p-3 rounded-lg shadow-sm border-l-4 border-secondary morph-glass-card">
                            <strong class="text-secondary block mb-1">အပြန်အလှန်ဖတ်</strong>
                            <div class="text-sm text-gray-200">သမ္မာကျမ်းစာကို အပြန်အလှန်ဖတ်ရှုခြင်း</div>
                        </div>
                        <!-- Role Item for Praise -->
                        <div class="p-3 rounded-lg shadow-sm border-l-4 border-secondary morph-glass-card">
                            <strong class="text-secondary block mb-1">Solo ချီးမွမ်း</strong>
                            <div class="text-sm text-gray-200">တစ်ဦးတည်း သို့မဟုတ် အဖွဲ့လိုက် ချီးမွမ်းခြင်း</div>
                        </div>
                        <!-- Role Item for Offering -->
                        <div class="p-3 rounded-lg shadow-sm border-l-4 border-secondary morph-glass-card">
                            <strong class="text-secondary block mb-1">အလှူငွေဆပ်ကပ်</strong>
                            <div class="text-sm text-gray-200">အလှူငွေများကောက်ခံပြီး ဆုတောင်းပေးခြင်း</div>
                        </div>
                        <!-- Role Item for Fullness Prayer -->
                        <div class="p-3 rounded-lg shadow-sm border-l-4 border-secondary morph-glass-card">
                            <strong class="text-secondary block mb-1">ပြည့်စုံဆုတောင်း</strong>
                            <div class="text-sm text-gray-200">အစီအစဉ်အဆုံးတွင် ဆုတောင်းပေးခြင်း</div>
                        </div>
                        <!-- Role Item for Sermon/Program (ဒေသနာ) -->
                        <div class="p-3 rounded-lg shadow-sm border-l-4 border-secondary morph-glass-card">
                            <strong class="text-secondary block mb-1">ဒေသနာ</strong>
                            <div class="text-sm text-gray-200">၀တ်ပြု၊ ဆုတောင်း၊ သက်သေခံခြင်း သို့မဟုတ် လူငယ်အစည်းအဝေးများ ဦးဆောင်ခြင်း</div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Schedule Section (morph-glass-card applied) -->
            <section class="mb-8 p-4 rounded-xl shadow-inner morph-glass-card">
                <h2 class="text-xl md:text-2xl font-bold text-white border-b-2 border-white/50 pb-3 mb-4">
                    အစီအစဉ် (၈ ပတ်)
                </h2>
                
                <!-- Mobile Tabs (Background adjusted for glass effect) -->
                <div class="flex overflow-x-auto bg-white/20 p-1.5 rounded-lg mb-4 mobile-tabs">
                    <button class="tab-btn p-3 px-4 min-w-[70px] text-center rounded-md font-semibold text-white transition duration-300 mr-2 bg-white/30 shadow-md" data-target="month1">
                        လ ၁
                    </button>
                    <button class="tab-btn p-3 px-4 min-w-[70px] text-center rounded-md font-semibold text-white transition duration-300 mr-2 bg-white/30 shadow-md" data-target="month2">
                        လ ၂
                    </button>
                    <button class="tab-btn p-3 px-4 min-w-[70px] text-center rounded-md font-semibold text-white transition duration-300 bg-white/30 shadow-md" data-target="summary">
                        အကျဉ်းချုပ်
                    </button>
                </div>
                
                <!-- Month 1 Schedule (Generated by JS) -->
                <div id="month1" class="schedule-view active-view">
                    <div class="text-center bg-gray-700 text-white font-bold py-2 rounded-lg mb-4 text-lg">ပထမ လ</div>
                    <!-- Content will be injected here -->
                </div>
                
                <!-- Month 2 Schedule (Generated by JS) -->
                <div id="month2" class="schedule-view hidden">
                    <div class="text-center bg-gray-700 text-white font-bold py-2 rounded-lg mb-4 text-lg">ဒုတိယ လ</div>
                    <!-- Content will be injected here -->
                </div>
                
                <!-- Summary View (Generated by JS) -->
                <div id="summary" class="schedule-view hidden">
                    <div class="text-center bg-gray-700 text-white font-bold py-2 rounded-lg mb-4 text-lg">အကျဉ်းချုပ်</div>
                    
                    <div class="p-4 rounded-xl shadow-lg overflow-x-auto morph-glass-card">
                        <table class="w-full text-left border-collapse min-w-[750px] summary-table">
                            <thead>
                                <tr>
                                    <th class="bg-primary text-white p-3 rounded-tl-lg">အပတ်</th>
                                    <th class="bg-primary text-white p-3">သဘာပတိ</th>
                                    <th class="bg-primary text-white p-3">Piano</th>
                                    <th class="bg-primary text-white p-3">အပြန်အလှန်ဖတ်</th> 
                                    <th class="bg-primary text-white p-3">Solo ချီးမွမ်း</th>
                                    <th class="bg-primary text-white p-3">အလှူငွေဆပ်ကပ်</th>
                                    <th class="bg-primary text-white p-3">ပြည့်စုံဆုတောင်း</th>
                                    <th class="bg-primary text-white p-3 rounded-tr-lg">ဒေသနာ</th>
                                </tr>
                            </thead>
                            <tbody id="summary-tbody">
                                <!-- Summary content will be injected here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
            
            <!-- Note Section -->
            <section class="mb-8 p-4 rounded-xl shadow-inner morph-glass-card border-l-4 border-yellow-400">
                <h2 class="text-xl md:text-2xl font-bold text-yellow-300 border-b-2 border-yellow-400/50 pb-3 mb-4">
                    မှတ်ချက် (Notice)
                </h2>
                <div class="text-white text-base leading-relaxed">
                    Hpa Rat Hkawn နဲ့ Zami Shine တစ်ခါတစ်ရန် တစ်ပတ်မှာ တာဝန် ၂ ခု ယူရတာမျိုးရှိပါလိပ်မယ်။ အကြောင်းရင်းကတော့ သူတို့ ၂ ဦးပဲ Hymn song အတွက် Piano တီးတတ်တဲ့ကြောင့်ပါ။ အလှည့်ကျ တာဝန်ယူရတာမျိုးလုပ်ထားပေးပါတယ် တစ်ယောက်ထဲ သဘာပတိ ၂ ခါယူတာမျိုး မဖြစ်ရအောင်ပါ။ ခြွင်းချက်အနေနဲ့ Hpa Rat Hkawn နဲ့ Zami Shine တို့က အခွင့်ထူးအနေနဲ့ ၁ ပတ်မှာ တာဝန် ၂ ခု ယူရတာမျိုးရှိပါလိပ်မယ်။
                </div>
            </section>

            <!-- START: Visitor Count Section (NEW) -->
            <section class="p-4 rounded-xl shadow-inner morph-glass-card text-center border-t border-b border-white/40">
                <div class="flex flex-col items-center justify-center">
                    <p class="text-sm uppercase tracking-wider opacity-80 mb-2">
                        စုစုပေါင်း လာရောက်လေ့လာသူ
                    </p>
                    <div id="visitor-count-display" class="text-4xl font-extrabold text-secondary tracking-widest" style="background: linear-gradient(90deg, #10b981 0%, #059669 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                        ...
                    </div>
                    <p class="text-xs mt-1 opacity-60">(အုပ်ချုပ်သူ မပါဝင်ပါ)</p>
                </div>
            </section>
            <!-- END: Visitor Count Section (NEW) -->
        </div>
        
        <!-- FOOTER SECTION -->
        <footer class="text-center p-4 bg-white/20 text-white text-xs rounded-b-xl border-t border-white/50">
            &copy; ၂၀၂၅ လူငယ်ဝတ်ပြုခြင်းအစီစဉ်<br>
           <br>
            ကောင်းကြီးနဲ့ပြည့်စုံသော နေ့ဖြစ်ပါစေ <br>
            ❤️ In Love of Jesus ❤️
        </footer>
    </div>

    <!-- JavaScript for Firebase, Data Management and Rendering -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { 
            getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, setPersistence, browserSessionPersistence 
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { 
            getFirestore, doc, setDoc, getDoc, updateDoc, increment, runTransaction, onSnapshot
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // Use 'Debug' for console logging
        setLogLevel('Debug');

        // --- GLOBAL CONFIGS & VARS ---
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let app, db, auth;
        let userId = null;
        let isAuthReady = false;

        // NOTE: Replace this placeholder with the actual UID of the administrator 
        // once they have signed in for the first time.
        const ADMIN_USER_ID = "YOUR_ADMIN_UID_HERE"; 
        
        const VISITOR_COUNT_PATH = `/artifacts/${appId}/public/data/site_metadata/visitor_count`;

        // --- FIREBASE INITIALIZATION & AUTHENTICATION ---
        async function initializeFirebase() {
            try {
                if (Object.keys(firebaseConfig).length > 0) {
                    app = initializeApp(firebaseConfig);
                    db = getFirestore(app);
                    auth = getAuth(app);

                    // Set persistence to session to avoid constant re-authentications
                    await setPersistence(auth, browserSessionPersistence);

                    onAuthStateChanged(auth, async (user) => {
                        if (user) {
                            userId = user.uid;
                        } else {
                            // If no user is signed in, sign in anonymously or with custom token
                            if (initialAuthToken) {
                                await signInWithCustomToken(auth, initialAuthToken);
                                userId = auth.currentUser.uid;
                            } else {
                                await signInAnonymously(auth);
                                userId = auth.currentUser.uid;
                            }
                        }
                        isAuthReady = true;
                        console.log("Firebase Auth Ready. User ID:", userId);
                        
                        // Proceed to app logic once auth is ready
                        initAppContent();
                    });
                } else {
                    console.error("Firebase config is missing.");
                    initAppContent(); // Run app logic without Firebase functionality
                }
            } catch (error) {
                console.error("Error during Firebase initialization or sign-in:", error);
                initAppContent(); // Run app logic without Firebase functionality
            }
        }

        // --- VISITOR COUNT LOGIC ---

        /**
         * Checks if the current user is the administrator based on the predefined UID.
         * @returns {boolean} True if the current user is the administrator.
         */
        function isCurrentUserAdmin() {
            if (userId === ADMIN_USER_ID) {
                console.log("Current user is Admin. Count will be excluded.");
                return true;
            }
            return false;
        }

        /**
         * Fetches the current visitor count and sets up a real-time listener.
         */
        function setupVisitorCountListener() {
            if (!db) return;
            const docRef = doc(db, VISITOR_COUNT_PATH);
            const displayElement = document.getElementById('visitor-count-display');

            onSnapshot(docRef, (docSnap) => {
                const count = docSnap.exists() ? docSnap.data().count : 0;
                // Format the count with leading zeros for aesthetic appeal
                displayElement.textContent = count.toString().padStart(6, '0');
                console.log("Visitor Count updated:", count);
            }, (error) => {
                console.error("Error listening to visitor count:", error);
                displayElement.textContent = 'FETCH ERROR';
            });
        }

        /**
         * Increments the public visitor count if the user is not an administrator.
         */
        async function incrementVisitorCount() {
            if (!db || isCurrentUserAdmin()) {
                return; // Do nothing if not initialized or if the user is the admin
            }

            const docRef = doc(db, VISITOR_COUNT_PATH);

            try {
                await runTransaction(db, async (transaction) => {
                    const docSnap = await transaction.get(docRef);

                    if (docSnap.exists()) {
                        // Increment the existing count
                        transaction.update(docRef, { 
                            count: increment(1),
                            lastVisit: new Date().toISOString()
                        });
                        console.log("Visitor count incremented.");
                    } else {
                        // Document doesn't exist, create it starting at 1
                        transaction.set(docRef, { 
                            count: 1, 
                            lastVisit: new Date().toISOString() 
                        });
                        console.log("Visitor count initialized to 1.");
                    }
                });
            } catch (error) {
                console.error("Transaction failed to increment visitor count:", error);
            }
        }


        // --- LOCAL DATA STRUCTURE ---
        const scheduleData = [
            { week: 1, month: 1, roles: {
                chairperson: "Tu Mai", scripture: "Seng Awng", praise: "Htoi Tsin Pan", offering: "May Lat Lunn", fullness: "Ah Dau", 
                piano: "Zami Shine", additionalRole: "Sr. Dau Gyung",
            }},
            { week: 2, month: 1, roles: {
                chairperson: "Dee Bine", scripture: "Benjamin", praise: "Zami Shar", offering: "Mi Mi Shar", fullness: "Shin Ram",
                piano: "Hpa Rat Hkawn", additionalRole: "ကျမ်းစာဖတ်<br>သက်သေခံခြင်း",
            }},
            { week: 3, month: 1, roles: {
                chairperson: "Hpa Rat Hkawn", scripture: "Zami Shine", praise: "Pan Ra", offering: "Caroline", fullness: "Htoi Tsin Pan",
                piano: "Zami Shine", additionalRole: "Srm. Ah Dim",
            }},
            { week: 4, month: 1, roles: {
                chairperson: "May Lat Lunn", scripture: "Ah Dau", praise: "Tu Mai", offering: "Seng Awng", fullness: "Dee Bine",
                piano: "Hpa Rat Hkawn", additionalRole: "Youth Meeting",
            }},
            { week: 5, month: 2, roles: {
                chairperson: "Benjamin", scripture: "Shin Ram", praise: "Mi Mi Shar", offering: "Zami Shar", fullness: "Zami Shine",
                piano: "Zami Shine", additionalRole: "Sr. Dee Ram",
            }},
            { week: 6, month: 2, roles: {
                chairperson: "Caroline", scripture: "Pan Ra", praise: "Hpa Rat Hkawn", offering: "Dee Bine", fullness: "Tu Mai",
                piano: "Hpa Rat Hkawn", additionalRole: "ကျမ်းစာဖတ်<br>သက်သေခံခြင်း",
            }},
            { week: 7, month: 2, roles: {
                chairperson: "Mi Mi Shar", scripture: "Htoi Tsin Pan", praise: "Benjamin", offering: "Shin Ram", fullness: "Hpa Rat Hkawn",
                piano: "Zami Shine", additionalRole: "Srm. Ah Ning",
            }},
            { week: 8, month: 2, roles: {
                chairperson: "Zami Shar", scripture: "May Lat Lunn", praise: "Ah Dau", offering: "Zami Shine", fullness: "Caroline",
                piano: "Hpa Rat Hkawn", additionalRole: "Youth Meeting",
            }},
        ];

        // --- ROLE LABELS (Defines display order and labels) ---
        const roleLabels = {
            chairperson: "သဘာပတိ",
            piano: "Piano", 
            scripture: "အပြန်အလှန်ဖတ်", 
            praise: "Solo ချီးမွမ်း",
            offering: "အလှူငွေဆပ်ကပ်",  
            fullness: "ပြည့်စုံဆုတောင်း",
            additionalRole: "ဒေသနာ",
        };

        // --- ACCORDION TOGGLE FUNCTION ---

        function toggleSection(contentId, button) {
            const content = document.getElementById(contentId);
            const icon = button.querySelector('span');
            const isExpanded = content.getAttribute('aria-expanded') === 'true';

            if (isExpanded) {
                // Collapse
                content.classList.remove('max-h-screen', 'pb-4', 'pt-2');
                content.classList.add('max-h-0');
                icon.classList.remove('rotate-45');
                content.setAttribute('aria-expanded', 'false');
            } else {
                // Expand
                content.classList.remove('max-h-0');
                content.classList.add('max-h-screen', 'pb-4', 'pt-2'); 
                icon.classList.add('rotate-45'); 
                content.setAttribute('aria-expanded', 'true');
            }
        }

        // --- DYNAMIC RENDERING FUNCTIONS (unmodified) ---

        function renderWeekBlock(weekData) {
            let rolesHtml = '';
            
            Object.entries(roleLabels).forEach(([key, label]) => {
                let name = weekData.roles[key] || '-';
                
                const displayLabel = label.endsWith('ခြင်း') ? label.slice(0, -3) : label;
                
                rolesHtml += `
                    <div class="flex justify-between p-3 border-b border-dashed border-white/50 items-center last:border-b-0"> 
                        <span class="font-bold text-secondary">${displayLabel}</span> 
                        <span class="text-white">${name}</span>
                    </div>
                `;
            });

            return `
                <div class="p-4 rounded-xl shadow-lg mb-0 border-t-4 border-primary morph-glass-card h-full">
                    <div class="text-center text-xl font-bold bg-primary text-white py-3 rounded-lg mb-4">
                        ${weekData.week} ပတ်
                    </div>
                    <div class="flex flex-col space-y-2">
                        ${rolesHtml}
                    </div>
                </div>
            `;
        }

        function renderMonthlySchedule(month, containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;

            const weeks = scheduleData.filter(d => d.month === month);
            let monthHtml = weeks.map(weekData => renderWeekBlock(weekData)).join('');
            
            const monthTitleHtml = `<div class="text-center bg-gray-700 text-white font-bold py-2 rounded-lg mb-4 text-lg">${month === 1 ? 'ပထမ လ' : 'ဒုတိယ လ'}</div>`;
            const gridWrapper = `<div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">${monthHtml}</div>`;
            
            container.innerHTML = monthTitleHtml + gridWrapper;
        }

        function renderSummaryTable() {
            const tbody = document.getElementById('summary-tbody');
            if (!tbody) return;

            const roleKeys = Object.keys(roleLabels);
            
            const summaryHtml = scheduleData.map((weekData, index) => {
                const rowClass = index % 2 === 0 ? 'bg-white/10' : 'bg-transparent';
                
                let roleCells = roleKeys.map(key => {
                    let roleValue = weekData.roles[key] || '-';
                    return `<td class="p-3">${roleValue}</td>`;
                }).join('');

                return `
                    <tr class="${rowClass} text-white hover:bg-white/20 transition duration-200">
                        <td class="p-3">${weekData.week} ပတ်</td>
                        ${roleCells}
                    </tr>
                `;
            }).join('');

            tbody.innerHTML = summaryHtml;
        }

        // --- TAB SWITCHING LOGIC (unmodified) ---

        function showSchedule(viewId) {
            document.querySelectorAll('.schedule-view').forEach(view => {
                view.classList.add('hidden');
            });

            const selectedView = document.getElementById(viewId);
            if (selectedView) {
                selectedView.classList.remove('hidden');
            }

            document.querySelectorAll('.tab-btn').forEach(btn => {
                const isActive = btn.getAttribute('data-target') === viewId;
                
                btn.classList.toggle('bg-primary', isActive);
                btn.classList.toggle('shadow-xl', isActive);
                btn.classList.toggle('bg-white/30', !isActive);
                btn.classList.toggle('shadow-md', !isActive);
            });
        }
        
        /**
         * Initializes the dynamic content and UI events.
         */
        function initAppContent() {
            // 1. Render all dynamic sections using the structured data
            renderMonthlySchedule(1, 'month1');
            renderMonthlySchedule(2, 'month2');
            renderSummaryTable();
            
            // 2. Setup event listeners for tabs
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    showSchedule(btn.getAttribute('data-target'));
                });
            });

            // 3. Set initial tab state
            showSchedule('month1');

            // 4. Firebase-dependent functions
            if (isAuthReady && db) {
                // Set up listener to display the count immediately
                setupVisitorCountListener(); 
                
                // Increment the count if the user is not an admin.
                incrementVisitorCount(); 
            }
        }

        // --- INITIALIZATION ---
        initializeFirebase();
    </script>
</body>
</html>
