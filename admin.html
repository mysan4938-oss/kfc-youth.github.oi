<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>အစီအစဉ် စီမံခန့်ခွဲရေး - Admin Panel</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Pyidaungsu', 'Myanmar Text', 'Inter', 'sans-serif'],
                    },
                    colors: {
                        'admin-primary': '#374151', // Deep Slate Gray for admin theme
                        'admin-secondary': '#6b7280', // Lighter Slate
                        'save-button': '#10b981', // Emerald Green for save
                        'save-button-hover': '#059669',
                        'delete-button': '#ef4444', // Red for danger
                    }
                }
            }
        }
    </script>
    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, onSnapshot, collection, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Global variables provided by the environment
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let db, auth;
        let authReady = false;
        let currentSchedule = [];
        let currentParticipants = { girls: [], boys: [] };
        let currentRoleLabels = {};
        let adminUserId = null; // Storing the authenticated user's ID

        setLogLevel('Debug');

        // --- Initial Data Structure (Used as fallback/template) ---
        const initialData = {
            roleLabels: {
                chairperson: "သဘာပတိ",
                piano: "Piano", 
                scripture: "အပြန်အလှန်ဖတ်",
                praise: "Solo ချီးမွမ်း",
                additionalRole: "ဒေသနာ", 
                offering: "အလှူငွေဆပ်ကပ်",
                announcement: "ကြေညာချိန်",
                fullness: "ပြည့်စုံဆုတောင်း",
            },
            scheduleData: [
                { week: 1, month: 1, roles: { chairperson: "Tu Mai", scripture: "Seng Awng", praise: "Htoi Tsin Pan", offering: "May Lat Lunn", fullness: "Ah Dau", piano: "Zami Shine", additionalRole: "Sr. Dau Gyung", announcement: "အတွင်းရေးမှူး" }},
                { week: 2, month: 1, roles: { chairperson: "Dee Bine", scripture: "Benjamin", praise: "Zami Shar", offering: "Mi Mi Shar", fullness: "Shin Ram", piano: "Hpa Rat Hkawn", additionalRole: "ကျမ်းစာဖတ်<br>သက်သေခံခြင်း", announcement: "အတွင်းရေးမှူး" }},
                { week: 3, month: 1, roles: { chairperson: "Hpa Rat Hkawn", scripture: "Zami Shine", praise: "Pan Ra", offering: "Caroline", fullness: "Htoi Tsin Pan", piano: "Zami Shine", additionalRole: "Srm. Ah Dim", announcement: "အတွင်းရေးမှူး" }},
                { week: 4, month: 1, roles: { chairperson: "May Lat Lunn", scripture: "Ah Dau", praise: "Tu Mai", offering: "Seng Awng", fullness: "Dee Bine", piano: "Hpa Rat Hkawn", additionalRole: "Youth Meeting", announcement: "အတွင်းရေးမှူး" }},
            ],
            participants: {
                girls: ["May Lat Lunn", "Htoi Tsin Pan", "Zami Shar", "Mi Mi Shar", "Zami Shine", "Pan Ra", "Hpa Rat Hkawn", "Caroline"],
                boys: ["Tu Mai", "Seng Awng", "Ah Dau", "Dee Bine", "Benjamin", "Shin Ram"],
            }
        };

        // --- Firebase Setup and Authentication ---
        async function setupFirebaseAndAuth() {
            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                // --- CRITICAL AUTHENTICATION STEP ---
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    // Fallback to anonymous, but editing will fail unless the rules allow it.
                    await signInAnonymously(auth);
                }
                // ------------------------------------

                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        authReady = true;
                        adminUserId = user.uid; // Store the ID of the authenticated user (THE ADMIN)
                        document.getElementById('admin-id-display').textContent = `Admin ID: ${adminUserId}`;
                        
                        document.getElementById('loading-state').classList.add('hidden');
                        document.getElementById('admin-content').classList.remove('hidden');
                        loadDataFromFirestore();
                    } else {
                        // This case handles anonymous sign-in or sign-out.
                        // We still allow loading, but writing requires a specific ID (handled below).
                        authReady = true;
                        document.getElementById('admin-id-display').textContent = 'Admin ID: Not Signed In (Read-Only)';
                        document.getElementById('loading-state').classList.add('hidden');
                        document.getElementById('admin-content').classList.remove('hidden');
                        loadDataFromFirestore();
                        showMessage("Warning: You are not signed in with the Admin account. Saving changes may fail.", true);
                    }
                });

            } catch (error) {
                console.error("Firebase setup or authentication failed:", error);
                showMessage(`Firebase Error: ${error.message}`, true);
            }
        }

        // --- Firestore Data Operations ---

        // NOTE: Data path is now PRIVATE to the authenticated user's ID
        const DATA_PATH = (uid) => `/artifacts/${appId}/users/${uid}/schedule_config`;
        const DATA_DOC_ID = 'schedule_data';

        const docRef = (uid) => {
            // If the user is authenticated, use their private path
            if (uid) {
                return doc(db, DATA_PATH(uid), DATA_DOC_ID);
            }
            // If anonymous/not authenticated, we can use the default public path for reading, 
            // but writing will fail the security check.
            return doc(db, `/artifacts/${appId}/public/data/youth_schedule`, DATA_DOC_ID);
        };
        
        // This is the public path used by the main index.html for reading.
        // The admin must WRITE to this PUBLIC path.
        const PUBLIC_DOC_REF = () => doc(db, `/artifacts/${appId}/public/data/youth_schedule`, 'schedule_config');


        function showMessage(message, isError = false) {
            const statusDiv = document.getElementById('status-message');
            statusDiv.classList.remove('hidden', 'bg-green-100', 'bg-red-100', 'text-green-800', 'text-red-800', 'bg-yellow-100', 'text-yellow-800');
            
            let bgClass = isError ? 'bg-red-100' : 'bg-green-100';
            let textClass = isError ? 'text-red-800' : 'text-green-800';

            if (message.includes("Warning")) {
                bgClass = 'bg-yellow-100';
                textClass = 'text-yellow-800';
            }

            statusDiv.classList.add(bgClass, textClass);
            statusDiv.textContent = message;
            setTimeout(() => { statusDiv.classList.add('hidden'); }, 6000);
        }

        async function loadDataFromFirestore() {
            if (!authReady || !db) return;
            try {
                // Admin reads from the PUBLIC document to ensure they see what the public sees.
                const docSnap = await getDoc(PUBLIC_DOC_REF());
                let dataToLoad;

                if (docSnap.exists()) {
                    dataToLoad = docSnap.data();
                    showMessage("Data loaded successfully from Public Firestore document.");
                } else {
                    dataToLoad = initialData;
                    // Attempt to write initial data to public path (requires admin privileges)
                    await setDoc(PUBLIC_DOC_REF(), initialData);
                    showMessage("Public document not found. Initialized and attempted to save default data.", dataToLoad.scheduleData.length === 0);
                }

                // Update global state
                currentSchedule = dataToLoad.scheduleData || initialData.scheduleData;
                currentParticipants = dataToLoad.participants || initialData.participants;
                currentRoleLabels = dataToLoad.roleLabels || initialData.roleLabels;

                // Render forms
                renderRoleLabelsInput(currentRoleLabels);
                renderParticipantsInput(currentParticipants);
                renderScheduleForm(currentSchedule, currentParticipants, currentRoleLabels);

            } catch (error) {
                console.error("Error loading data:", error);
                showMessage("Error loading data: " + error.message, true);
            }
        }
        
        // --- Week Management Logic ---
        
        function getNextMonth(currentMonth, nextWeekIndex) {
            return Math.floor(nextWeekIndex / 4) + 1;
        }

        window.addWeek = function() {
            if (currentSchedule.length === 0) {
                currentSchedule.push({
                    week: 1,
                    month: 1,
                    roles: createDefaultRoles(currentRoleLabels)
                });
            } else {
                const lastWeek = currentSchedule[currentSchedule.length - 1];
                const newWeekNumber = lastWeek.week + 1;
                const newMonth = getNextMonth(lastWeek.month, currentSchedule.length);
                
                currentSchedule.push({
                    week: newWeekNumber,
                    month: newMonth,
                    roles: createDefaultRoles(currentRoleLabels)
                });
            }
            
            showMessage(`New Week ${currentSchedule.slice(-1)[0].week} added locally.`, false);
            renderScheduleForm(currentSchedule, currentParticipants, currentRoleLabels);
            
            // Auto-select the newly added week
            const weekSelector = document.getElementById('week-selector');
            if (weekSelector) {
                weekSelector.value = currentSchedule.slice(-1)[0].week;
                updateWeekForm(currentSchedule, currentParticipants, currentRoleLabels);
            }
        }

        window.removeWeek = function() {
            if (currentSchedule.length <= 1) {
                showMessage("Cannot remove the last week. Schedule must have at least one week.", true);
                return;
            }
            
            const weekSelector = document.getElementById('week-selector');
            const selectedWeek = parseInt(weekSelector.value);
            const indexToRemove = currentSchedule.findIndex(w => w.week === selectedWeek);
            
            if (indexToRemove === -1) {
                showMessage("Could not find selected week to remove.", true);
                return;
            }
            
            if (!confirm(`Are you sure you want to remove Week ${selectedWeek}? This cannot be undone locally.`)) {
                return;
            }
            
            // Remove the week
            currentSchedule.splice(indexToRemove, 1);
            
            // Re-index weeks and months after removal
            currentSchedule = currentSchedule.map((weekData, index) => ({
                ...weekData,
                week: index + 1, // Simple sequential week numbering
                month: getNextMonth(weekData.month, index),
            }));

            showMessage(`Week ${selectedWeek} removed and schedule re-indexed locally.`, false);
            renderScheduleForm(currentSchedule, currentParticipants, currentRoleLabels);

            // Auto-select the last week or the first one
            weekSelector.value = currentSchedule.slice(-1)[0].week;
            updateWeekForm(currentSchedule, currentParticipants, currentRoleLabels);
        }

        function createDefaultRoles(roleLabels) {
            const roles = {};
            Object.keys(roleLabels).forEach(key => {
                // Set default for specific known roles if needed, otherwise empty string
                if (key === 'announcement') {
                    roles[key] = "အတွင်းရေးမှူး";
                } else if (key === 'additionalRole') {
                    roles[key] = "ဒေသနာ";
                } else {
                    roles[key] = "";
                }
            });
            return roles;
        }

        // --- Form Rendering Functions (Unchanged logic, updated to use correct colors/classes) ---

        function renderRoleLabelsInput(labels) {
             document.getElementById('roles-json').value = JSON.stringify(labels, null, 2);
        }

        function renderParticipantsInput(participants) {
            document.getElementById('girls-input').value = participants.girls.join(', ');
            document.getElementById('boys-input').value = participants.boys.join(', ');
        }
        
        function getParticipantsFromInput() {
            const girlsText = document.getElementById('girls-input').value.split(',')
                .map(s => s.trim()).filter(s => s.length > 0);
            const boysText = document.getElementById('boys-input').value.split(',')
                .map(s => s.trim()).filter(s => s.length > 0);
            
            return { girls: girlsText, boys: boysText };
        }

        function renderScheduleForm(scheduleData, participants, roleLabels) {
            const editorDiv = document.getElementById('schedule-editor');
            if (!editorDiv) return;

            const weekSelector = document.getElementById('week-selector');
            weekSelector.innerHTML = scheduleData.map(week => 
                `<option value="${week.week}">အပတ် ${week.week} (${week.month} လ)</option>`
            ).join('');
            
            if (scheduleData.length > 0) {
                if (!weekSelector.value) {
                    weekSelector.value = scheduleData[0].week;
                }
                
                weekSelector.onchange = () => updateWeekForm(scheduleData, participants, roleLabels);

                updateWeekForm(scheduleData, participants, roleLabels);
            } else {
                 const formContainer = document.getElementById('current-week-form');
                 formContainer.innerHTML = `<p class="text-red-500 text-center py-4">အစီအစဉ် ဇယား ဒေတာ မရှိပါ။</p>`;
            }
        }
        
        function getParticipantOptions(participants, currentName) {
            let options = `<option value="">-- ရွေးချယ်ရန် --</option>`;
            
            let allNames = new Set([...participants.girls, ...participants.boys]);
            
            if (currentName && !allNames.has(currentName)) {
                 allNames.add(currentName);
            }

            Array.from(allNames).sort().forEach(name => {
                const isSelected = name === currentName ? 'selected' : '';
                options += `<option value="${name}" ${isSelected}>${name}</option>`;
            });

            return options;
        }


        function updateWeekForm(scheduleData, participants, roleLabels) {
            const weekSelector = document.getElementById('week-selector');
            const selectedWeekValue = weekSelector.value;
            
            if (!selectedWeekValue) {
                const formContainer = document.getElementById('current-week-form');
                formContainer.innerHTML = `<p class="text-red-500 text-center py-4">အပတ် ရွေးချယ်မှု မမှန်ကန်ပါ။</p>`;
                return;
            }
            
            const selectedWeek = parseInt(selectedWeekValue);
            const weekData = scheduleData.find(w => w.week === selectedWeek);
            const formContainer = document.getElementById('current-week-form');

            if (!weekData) {
                formContainer.innerHTML = `<p class="text-red-500 text-center py-4">ရွေးချယ်ထားသော အပတ်အတွက် ဒေတာ မတွေ့ပါ။</p>`;
                return;
            }

            let formHtml = `<input type="hidden" id="current-week-index" value="${scheduleData.indexOf(weekData)}">`;
            
            formHtml += `<h3 class="text-lg font-bold mb-4 border-b pb-2 text-admin-primary">အပတ် ${weekData.week} (${weekData.month} လ) တာဝန်များ</h3>`;

            Object.entries(roleLabels).forEach(([key, label]) => {
                const currentName = weekData.roles[key] || '';
                
                const options = getParticipantOptions(participants, currentName);

                const isAdditionalRole = key === 'additionalRole';
                
                if (isAdditionalRole) {
                    formHtml += `
                        <div class="mb-4 bg-white p-3 rounded-md border border-gray-200 shadow-sm">
                            <label class="block text-sm font-medium text-admin-primary mb-1">${label}</label>
                            <textarea id="role-${key}" class="mt-1 block w-full border border-gray-300 rounded-md shadow-inner p-2 focus:ring-save-button focus:border-save-button text-gray-800">${currentName.replace(/<br>/g, '\n')}</textarea>
                            <p class="text-xs text-gray-500 mt-1">မှတ်ချက်: Enter နှိပ်ပါက Line break ဖြစ်ပါမည်။</p>
                        </div>
                    `;
                } else {
                    formHtml += `
                        <div class="mb-4 bg-white p-3 rounded-md border border-gray-200 shadow-sm">
                            <label class="block text-sm font-medium text-admin-primary mb-1">${label}</label>
                            <select id="role-${key}" class="mt-1 block w-full pl-3 pr-10 py-2 border border-gray-300 bg-white rounded-md shadow-inner focus:outline-none focus:ring-save-button focus:border-save-button sm:text-sm text-gray-800">
                                ${options}
                            </select>
                        </div>
                    `;
                }
            });

            formHtml += `
                <div class="mt-6">
                    <button type="button" onclick="saveCurrentWeek()" class="w-full bg-save-button text-white font-bold py-3 px-4 rounded-xl hover:bg-save-button-hover transition duration-300 shadow-md">
                        <svg class="w-5 h-5 inline mr-2 align-text-bottom" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path></svg>
                        ဤအပတ်အတွက် ဒေတာ သိမ်းဆည်းရန် (Save This Week)
                    </button>
                    <p class="text-xs text-red-500 mt-2 text-center">Save This Week ကို နှိပ်ပြီးနောက်မှ Save All Changes ကို နှိပ်ပါ။</p>
                </div>
            `;
            
            formContainer.innerHTML = formHtml;
        }

        window.saveCurrentWeek = function() {
            const index = parseInt(document.getElementById('current-week-index').value);
            if (isNaN(index) || index < 0 || index >= currentSchedule.length) {
                showMessage("Error: Invalid week index. Please reload data.", true);
                return;
            }

            const newRoles = {};
            let isFormValid = true;

            Object.keys(currentRoleLabels).forEach(key => {
                const element = document.getElementById(`role-${key}`);
                if (!element) return;
                
                let value;
                if (element.tagName === 'SELECT') {
                    value = element.value;
                } else if (element.tagName === 'TEXTAREA') {
                    value = element.value.replace(/\n/g, '<br>');
                }

                if (!value && key !== 'additionalRole') {
                    isFormValid = false;
                }
                newRoles[key] = value || ''; 
            });
            
            if (!isFormValid) {
                showMessage(`Warning: Week ${currentSchedule[index].week} has empty roles. Fill all standard roles for the best appearance.`, true);
            }

            currentSchedule[index].roles = newRoles;
            showMessage(`Week ${currentSchedule[index].week} roles updated locally. Click 'Save All Changes' to commit.`, false);
        }

        // --- Master Save Function ---

        async function saveDataToFirestore() {
            // CRITICAL CHECK: Only allow saving if the admin user is authenticated
            if (!authReady || !db || !adminUserId) {
                showMessage("ACCESS DENIED: You must be signed in as the Admin user to save changes.", true);
                return;
            }

            try {
                const rolesJson = document.getElementById('roles-json').value;
                const roleLabels = JSON.parse(rolesJson);

                const participants = getParticipantsFromInput();
                
                const dataToSave = {
                    roleLabels,
                    participants,
                    scheduleData: currentSchedule
                };

                // 4. Write to the PUBLIC path. This requires the corresponding security rule.
                await setDoc(PUBLIC_DOC_REF(), dataToSave);

                showMessage("Data saved successfully to Firestore! Main schedule updated.", false);
                
                loadDataFromFirestore();

            } catch (error) {
                console.error("Error saving data:", error);
                showMessage("Error saving data (Permission Denied?). Please ensure you are the correct Admin user: " + error.message, true);
            }
        }

        window.toggleSection = (id, button) => {
            const el = document.getElementById(id);
            const icon = button.querySelector('span');

            if (el.classList.contains('hidden')) {
                el.classList.remove('hidden');
                icon.classList.add('rotate-180');
            } else {
                el.classList.add('hidden');
                icon.classList.remove('rotate-180');
            }
        };
        
        // Expose functions globally
        window.saveData = saveDataToFirestore;
        window.loadDataFromFirestore = loadDataFromFirestore;

        // Initialize the app
        document.addEventListener('DOMContentLoaded', setupFirebaseAndAuth);

    </script>
    <style>
        body {
            background-color: #e5e7eb; /* Light gray background for body */
            font-family: 'Pyidaungsu', 'Myanmar Text', 'Inter', sans-serif;
        }
        .admin-card {
            background-color: white;
            border-left: 5px solid #374151; /* Dark Slate border */
            transition: all 0.3s ease;
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); /* shadow-xl */
        }
        textarea {
            min-height: 50px;
            font-family: inherit;
            resize: vertical;
        }
        #roles-json {
            min-height: 250px;
            font-family: monospace;
        }
        .accordion-icon {
            transition: transform 0.3s ease;
            display: inline-block;
        }
    </style>
</head>
<body class="min-h-screen p-4 md:p-8">
    
    <div class="max-w-4xl mx-auto">
        <header class="bg-admin-primary text-white p-6 rounded-xl shadow-2xl mb-8 text-center" style="background: linear-gradient(135deg, #374151 0%, #4b5563 100%);">
            <h1 class="text-3xl font-extrabold mb-1">လူငယ်ဝတ်ပြုခြင်း အစီအစဉ် စီမံခန့်ခွဲရေး</h1>
            <p class="opacity-90">သတ်မှတ်ထားသော Admin တစ်ဦးတည်းသာ ပြင်ဆင်နိုင်ပါသည်</p>
            <div id="admin-id-display" class="text-sm mt-2 text-yellow-300 font-medium">
                <!-- Admin ID will be shown here -->
            </div>
        </header>

        <div id="loading-state" class="text-center p-8 bg-white rounded-xl shadow-md">
            <p class="text-xl text-admin-primary font-semibold">ဒေတာများကို ဝန်ဆောင်မှုမှ ရယူနေပါသည်...</p>
        </div>

        <div id="admin-content" class="space-y-6 hidden">
            
            <!-- Status Message -->
            <div id="status-message" class="hidden p-4 rounded-lg font-medium shadow-md transition duration-300 border">
                <!-- Messages will appear here -->
            </div>

            <p class="text-sm text-gray-700 bg-yellow-100 p-3 rounded-xl border-l-4 border-yellow-500 shadow-md">
                **သတိပြုရန်:** Admin အဖြစ် ဝင်ရောက်ထားသူသာ **Save All Changes** ဖြင့် ဒေတာကို Firestore တွင် သိမ်းဆည်းနိုင်မည်။ အခြားသူများ ပြင်ဆင်ရန် ကြိုးစားပါက "Permission Denied" အမှား ပြပါမည်။
            </p>
            
            <!-- Participants Section (Form-based) -->
            <div class="p-5 rounded-xl shadow-lg admin-card">
                <h2 class="text-xl font-bold text-gray-800 cursor-pointer flex justify-between items-center" 
                    onclick="toggleSection('participants-content', this)">
                    ၁။ ပါဝင်သူများ စာရင်း (Participants List)
                    <span class="text-admin-primary text-2xl accordion-icon">+</span>
                </h2>
                <div id="participants-content" class="pt-4 hidden">
                    <p class="text-xs text-gray-600 mb-3 border-b pb-2">အမည်များကို **Comma (,)** ခြား၍ ထည့်သွင်းပါ။</p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="girls-input" class="block text-sm font-medium text-admin-primary mb-1">မိန်းကလေးများ (Girls)</label>
                            <textarea id="girls-input" class="w-full border border-gray-300 rounded-lg p-2 focus:ring-save-button focus:border-save-button text-gray-800" placeholder="ဥပမာ: May Lat Lunn, Htoi Tsin Pan, Zami Shar"></textarea>
                        </div>
                        <div>
                            <label for="boys-input" class="block text-sm font-medium text-admin-primary mb-1">ယောင်္ကျားလေးများ (Boys)</label>
                            <textarea id="boys-input" class="w-full border border-gray-300 rounded-lg p-2 focus:ring-save-button focus:border-save-button text-gray-800" placeholder="ဥပမာ: Tu Mai, Seng Awng, Ah Dau"></textarea>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Schedule Data Section (Form-based) -->
            <div class="p-5 rounded-xl shadow-lg admin-card">
                <h2 class="text-xl font-bold text-gray-800 cursor-pointer flex justify-between items-center" 
                    onclick="toggleSection('schedule-data-editor', this)">
                    ၂။ အပတ်စဉ် အစီအစဉ် တာဝန်များ (Weekly Roles Assignment)
                    <span class="text-admin-primary text-2xl accordion-icon">+</span>
                </h2>
                <div id="schedule-data-editor" class="pt-4 hidden">
                    
                    <!-- Week Control Buttons -->
                    <div class="flex space-x-2 mb-4">
                        <button onclick="addWeek()" type="button" class="flex-1 bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-700 transition duration-300 shadow-md">
                            အပတ်ထပ်ထည့်မည် (+)
                        </button>
                        <button onclick="removeWeek()" type="button" class="flex-1 bg-delete-button text-white font-semibold py-2 px-4 rounded-lg hover:bg-red-600 transition duration-300 shadow-md">
                            ရွေးချယ်ထားသော အပတ် ဖျက်မည် (-)
                        </button>
                    </div>

                    <label for="week-selector" class="block text-sm font-bold text-admin-primary mb-2">အပတ် ရွေးချယ်ရန်</label>
                    <select id="week-selector" class="mb-4 block w-full pl-3 pr-10 py-2 border border-gray-400 bg-white rounded-md shadow-md focus:outline-none focus:ring-admin-primary focus:border-admin-primary sm:text-sm text-gray-800">
                        <!-- Options populated by JS -->
                    </select>

                    <div id="current-week-form" class="bg-gray-100 p-4 rounded-xl border border-gray-300 shadow-inner">
                        <!-- Dynamic role dropdowns will be inserted here -->
                        <p class="text-center text-gray-500 py-4">အပေါ်မှ အပတ်တစ်ခုကို ရွေးချယ်ပါ</p>
                    </div>
                </div>
            </div>

            <!-- Role Labels Section (Keeping JSON for flexibility) -->
            <div class="p-5 rounded-xl shadow-lg admin-card">
                <h2 class="text-xl font-bold text-gray-800 cursor-pointer flex justify-between items-center" 
                    onclick="toggleSection('roles-content', this)">
                    ၃။ တာဝန်အမည်များ (Role Labels - JSON) 
                    <span class="text-admin-primary text-2xl accordion-icon">+</span>
                </h2>
                <div id="roles-content" class="pt-4 hidden">
                    <p class="text-xs text-gray-600 mb-3 border-b pb-2">ဤအပိုင်းသည် အစီအစဉ်၏ ခေါင်းစဉ်များကို ပြောင်းလဲရန်ဖြစ်သည်။ JSON Format မှန်ကန်ရန် လိုအပ်သည်။</p>
                    <label for="roles-json" class="block text-sm font-medium text-admin-primary mb-2">roleLabels (JSON)</label>
                    <textarea id="roles-json" class="w-full border border-gray-300 rounded-lg p-3 focus:ring-save-button focus:border-save-button text-gray-800"></textarea>
                </div>
            </div>

            
            <!-- Master Save Button -->
            <button onclick="saveData()"
                class="w-full bg-admin-primary text-white font-bold py-4 px-6 rounded-xl hover:bg-admin-secondary transition duration-300 shadow-xl transform hover:scale-[1.005] active:scale-95">
                <svg class="w-6 h-6 inline mr-2 align-text-bottom" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.27a2 2 0 010 2.828l-6.83 6.83a2 2 0 01-2.828 0l-3.33-3.33a2 2 0 112.828-2.828l1.942 1.942 5.414-5.414a2 2 0 012.828 0z"></path></svg>
                အပြောင်းအလဲများ အားလုံး သိမ်းဆည်းရန် (Save All Changes)
            </button>

        </div>
    </div>
</body>
</html>


